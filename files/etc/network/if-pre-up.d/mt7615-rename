#!/bin/bash

FILE=/etc/udev/rules.d/70-persistent-net.rules
REBOOT=false
PCI=$(lspci | grep MEDIATEK | grep 7615 | cut -d" " -f 1)
if [[ ! -z "${PCI}" ]]; then
	cd /sys/class/net
	IFACES=($(ls -l | grep "${PCI}" | awk '{print $9}' | grep -v "^mt_"))
	for IFACE in ${IFACES[@]}; do
		# Change MAC address:
		MAC=$(ifconfig ${IFACE} | grep ether | awk '{print $2}')
		NEW=mt_24g
		[[ "${IFACE}" == "rename"* ]] && NEW=mt_50g
		if ! cat ${FILE} | grep ${MAC}; then
			echo "SUBSYSTEM==\"net\", DRIVERS==\"?*\", ATTR{address}==\"${MAC}\", NAME=\"${NEW}\"" >> $FILE
			REBOOT=true
		fi
	done
fi
[[ "$REBOOT" == "true" ]] && reboot now
exit 0
