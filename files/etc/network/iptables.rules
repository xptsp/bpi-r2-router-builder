*nat
# Allow masquerading connections as from wan interface:
-A POSTROUTING -o wan -j MASQUERADE

# Don't delete the 'COMMIT' line or these nat table rules won't be processed
COMMIT

*filter
# Default iptables policies:
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]

# Reject everything coming from user VPN:
-A OUTPUT ! -o lo -m owner --uid-owner vpn -j DROP

# On WAN, accept all established and related connections and drop everything else.
-A INPUT -i wan -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
-A INPUT -i wan -j DROP

# On WAN, forward all established and related connections and drop everything else.
-A FORWARD -i wan -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
-A FORWARD -i wan -j DROP

# Don't delete the 'COMMIT' line or these nat table rules won't be processed
COMMIT
